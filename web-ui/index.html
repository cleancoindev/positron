<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Positron Demo App</title>
  </head>
  <body>
    <h1>Positron Demo App</h1>
    <p>The current ptlib.PositronContext state is: <span id="result">loading...</span></p>
    <p><input type="button" value="Increment" id="buttonIncr" /></p>
    <script>
const api = (() => {
  // if we are in `electron` mode
  if (require) {
    const { ipcRenderer } = require('electron')
    return {
      on: (cb) => {
        ipcRenderer.on('pt-msg', (evt, data) => {
          cb(JSON.parse(data))
        })
      },
      send: (data) => {
        ipcRenderer.send('pt-msg', JSON.stringify(data))
      }
    }
  }
  throw new Error('could not initialize api!')
})()

const resultElem = document.getElementById('result')
const incrButton = document.getElementById('buttonIncr')
function dispResult (data) {
  while (resultElem.childNodes.length) {
    resultElem.removeChild(resultElem.childNodes[0])
  }
  resultElem.appendChild(document.createTextNode(data))
}

api.on((data) => {
  if (data.error) {
    dispResult('Error: ' + data.error)
  } else {
    dispResult(data.response.state)
  }
})
api.send({
  method: 'peek'
})

incrButton.onclick = () => {
  api.send({
    method: 'incr'
  })
}
    </script>
  </body>
</html>
